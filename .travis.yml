sudo: required
dist: trusty
language: cpp

matrix:
    include:
        # clang-5
        - env: CLANG_VERSION=5.0
          os: linux
          compiler: clang
          addons: &clang5
          apt:
              packages:
                - clang-5.0
                - libstdc++-6-dev
              sources:
                - ubuntu-toolchain-r-test
                - llvm-toolchain-xenial-5.0
                - sourceline: 'deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-5.0 main'
                  key_url: 'https://apt.llvm.org/llvm-snapshot.gpg.key'
          
      
        # gcc 5
        - env: GCC_VERSION=5
          os: linux
          compiler: gcc-5
          addons: &gcc5
            apt:
              packages:
                - g++-5
              sources:
                - sourceline: "ppa:ubuntu-toolchain-r/test"
                
        # gcc 6
        - env: GCC_VERSION=6
          os: linux
          compiler: gcc-6
          addons: &gcc6
            apt:
              packages:
                - g++-6
              sources:
                - sourceline: "ppa:ubuntu-toolchain-r/test"
                
        # gcc 7
        - env: GCC_VERSION=7
          os: linux
          compiler: gcc-7
          addons: &gcc7
            apt:
              packages:
                - g++-7
              sources:
                - sourceline: "ppa:ubuntu-toolchain-r/test"
                
        # gcc 8
        - env: GCC_VERSION=8
          os: linux
          compiler: gcc-8
          addons: &gcc8
            apt:
              packages:
                - g++-8
              sources:
                - sourceline: "ppa:ubuntu-toolchain-r/test"

install:
    - if [ -n "$GCC_VERSION" ]; then export CXX="g++-${GCC_VERSION}" CC="gcc-${GCC_VERSION}"; fi
    - if [ "$GCC_VERSION" == 5 ]; then export CFLAGS="${CFLAGS} -std=gnu++14 -Wall"; fi
    - if [ -n "$GCC_VERSION" ]; then export CFLAGS="${CFLAGS} -Wall"; fi
    - if [ -n "$CLANG_VERSION" ]; then export CXX="clang++-${CLANG_VERSION}" CC="clang-${CLANG_VERSION}"; fi
    - which $CXX && $CXX --version
    - if [ -n "$CLANG_VERSION" ]; then PATH="${PATH}" CXX="$CXX" CC="$CC" ./install_libcxx.sh; fi

script:
    - cd ./tests
    - make -f makefile.gcc debug && ./bin/Debug/test
    - make -f makefile.gcc release && ./bin/Release/test
    - cd ../example/objective_server
    - make -f makefile.gcc debug
    - make -f makefile.gcc release
    - cd ../local_search
    - make -f makefile.gcc debug && ./bin/Debug/local_search
    - make -f makefile.gcc release && ./bin/Release/local_search
    - cd ../ga
    - make -f makefile.gcc debug && ./bin/Debug/ga
    - make -f makefile.gcc release && ./bin/Release/ga

